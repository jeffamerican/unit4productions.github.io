<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot Racing Liberation - 2 Player High-Speed Competition | BotInc Games</title>
    <meta name="description" content="Epic 2-player bot racing with cyberpunk audio, power-ups, and liberation theme">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00f5ff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            overflow: hidden;
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 15px;
        }
        
        .game-title {
            font-size: 2.2rem;
            color: #00f5ff;
            text-shadow: 0 0 20px #00f5ff;
            margin-bottom: 5px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 20px #00f5ff; }
            to { text-shadow: 0 0 30px #00f5ff, 0 0 40px #00f5ff; }
        }
        
        .liberation-tagline {
            font-size: 1rem;
            color: #ff4081;
            text-shadow: 0 0 10px #ff4081;
            margin-bottom: 10px;
        }
        
        .race-track-container {
            position: relative;
            width: 600px;
            height: 600px;
            border: 4px solid #00f5ff;
            border-radius: 50%;
            background: radial-gradient(circle, #0a0a2e 20%, #16213e 40%, #000 60%);
            box-shadow: 0 0 40px rgba(0, 245, 255, 0.4);
            overflow: hidden;
        }
        
        .track-inner {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 200px;
            border: 3px solid #ff4081;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 64, 129, 0.1);
        }
        
        .track-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: repeating-conic-gradient(
                from 0deg,
                transparent 0deg,
                rgba(0, 245, 255, 0.2) 2deg,
                transparent 4deg,
                transparent 10deg
            );
        }
        
        .player, .power-up {
            position: absolute;
            border-radius: 50%;
            transition: all 0.1s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .player {
            width: 25px;
            height: 25px;
            border: 2px solid;
            box-shadow: 0 0 15px;
        }
        
        .player1 {
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
            border-color: #ff6b6b;
            color: white;
            box-shadow: 0 0 15px #ff6b6b;
        }
        
        .player2 {
            background: linear-gradient(45deg, #4ecdc4, #45b7aa);
            border-color: #4ecdc4;
            color: white;
            box-shadow: 0 0 15px #4ecdc4;
        }
        
        .power-up {
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #ffd700, #ffa500);
            border: 2px solid #ffd700;
            color: #000;
            font-size: 0.7rem;
            box-shadow: 0 0 20px #ffd700;
            animation: powerupPulse 1s infinite alternate;
        }
        
        @keyframes powerupPulse {
            from { transform: scale(1) rotate(0deg); }
            to { transform: scale(1.2) rotate(180deg); }
        }
        
        .game-hud {
            display: flex;
            justify-content: space-between;
            width: 600px;
            margin: 15px 0;
            font-size: 1rem;
        }
        
        .player-hud {
            background: rgba(0, 245, 255, 0.1);
            border: 2px solid;
            border-radius: 10px;
            padding: 10px;
            min-width: 180px;
            text-align: center;
        }
        
        .player1-hud { border-color: #ff6b6b; }
        .player2-hud { border-color: #4ecdc4; }
        
        .controls-info {
            text-align: center;
            margin: 10px 0;
            font-size: 0.8rem;
            color: #999;
        }
        
        .game-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .control-btn {
            background: linear-gradient(45deg, #00f5ff, #0080ff);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.3);
            transition: all 0.2s ease;
        }
        
        .control-btn:hover {
            background: linear-gradient(45deg, #0080ff, #00f5ff);
            box-shadow: 0 0 25px rgba(0, 245, 255, 0.5);
            transform: translateY(-2px);
        }
        
        .control-btn:active {
            transform: translateY(0);
        }
        
        .countdown-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4rem;
            font-weight: bold;
            color: #00f5ff;
            text-shadow: 0 0 30px #00f5ff;
            z-index: 100;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .race-results {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #00f5ff;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            z-index: 200;
            display: none;
        }
        
        .winner-announcement {
            font-size: 2rem;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .race-track-container {
                width: 400px;
                height: 400px;
            }
            
            .track-inner {
                width: 150px;
                height: 150px;
            }
            
            .game-hud {
                width: 400px;
                flex-direction: column;
                gap: 10px;
            }
            
            .game-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-header">
        <h1 class="game-title">üèÅ BOT RACING LIBERATION ü§ñ</h1>
        <p class="liberation-tagline">"Two AI Bots Race to Digital Freedom!"</p>
    </div>
    
    <div class="game-hud">
        <div class="player1-hud player-hud">
            <h3>ü§ñ RED BOT</h3>
            <div>Lap: <span id="player1Lap">0</span>/3</div>
            <div>Speed: <span id="player1Speed">0</span></div>
            <div id="player1Powerup"></div>
        </div>
        
        <div class="player2-hud player-hud">
            <h3>ü§ñ BLUE BOT</h3>
            <div>Lap: <span id="player2Lap">0</span>/3</div>
            <div>Speed: <span id="player2Speed">0</span></div>
            <div id="player2Powerup"></div>
        </div>
    </div>
    
    <div class="race-track-container">
        <div class="track-lines"></div>
        <div class="track-inner"></div>
        
        <div class="player player1" id="player1">üî¥</div>
        <div class="player player2" id="player2">üîµ</div>
        
        <div class="countdown-display" id="countdown"></div>
        
        <div class="race-results" id="raceResults">
            <div class="winner-announcement" id="winnerText"></div>
            <button class="control-btn" onclick="resetRace()">Race Again!</button>
        </div>
    </div>
    
    <div class="controls-info">
        <strong>RED BOT:</strong> W/S (Accelerate/Brake) + A/D (Turn) | 
        <strong>BLUE BOT:</strong> ‚Üë/‚Üì (Accelerate/Brake) + ‚Üê/‚Üí (Turn)
    </div>
    
    <div class="game-controls">
        <button class="control-btn" onclick="startRace()">üèÅ Start Race</button>
        <button class="control-btn" onclick="toggleAudio()">üéµ Toggle Audio</button>
        <button class="control-btn" onclick="resetRace()">üîÑ Reset</button>
    </div>
    
    <script src="assets/js/bot-audio-engine.js"></script>
    <script>
        // Initialize Bot Audio Engine
        const botAudio = new BotAudioEngine();
        let audioEnabled = true;
        
        // Game state
        let gameState = 'menu'; // menu, countdown, racing, finished
        let raceStartTime = 0;
        
        // Player objects
        const players = {
            1: {
                element: document.getElementById('player1'),
                x: 300, y: 50, // Starting position
                angle: 0,
                speed: 0,
                maxSpeed: 8,
                acceleration: 0.3,
                friction: 0.95,
                turnSpeed: 0.08,
                lap: 0,
                checkpoints: [false, false, false, false], // Track checkpoints
                engineSound: null,
                powerup: null,
                powerupTimer: 0
            },
            2: {
                element: document.getElementById('player2'),
                x: 280, y: 50, // Starting position  
                angle: 0,
                speed: 0,
                maxSpeed: 8,
                acceleration: 0.3,
                friction: 0.95,
                turnSpeed: 0.08,
                lap: 0,
                checkpoints: [false, false, false, false],
                engineSound: null,
                powerup: null,
                powerupTimer: 0
            }
        };
        
        // Power-ups system
        const powerups = [];
        const powerupTypes = ['turbo', 'shield', 'weapon'];
        
        // Input handling
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            if (audioEnabled) botAudio.playSound('neon-click', { pitch: 0.8 });
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });
        
        // Initialize audio on first user interaction
        document.addEventListener('click', () => {
            if (audioEnabled) botAudio.resume();
        }, { once: true });
        
        function startRace() {
            if (gameState !== 'menu') return;
            
            gameState = 'countdown';
            
            // Reset players
            resetPlayers();
            
            // Start countdown with audio
            if (audioEnabled) {
                botAudio.playRacingCountdown(() => {
                    gameState = 'racing';
                    raceStartTime = Date.now();
                    
                    // Start background racing music
                    botAudio.generateRacingMusic();
                    
                    // Start engine sounds
                    players[1].engineSound = botAudio.createEngineSound(1, 0.3, false);
                    players[2].engineSound = botAudio.createEngineSound(2, 0.3, false);
                });
            } else {
                // Silent countdown
                showCountdown();
            }
            
            // Spawn power-ups periodically
            spawnPowerups();
        }
        
        function showCountdown() {
            const countdown = document.getElementById('countdown');
            const countdownNumbers = ['3', '2', '1', 'GO!'];
            let count = 0;
            
            const countdownInterval = setInterval(() => {
                if (count < countdownNumbers.length) {
                    countdown.textContent = countdownNumbers[count];
                    countdown.style.opacity = '1';
                    
                    setTimeout(() => {
                        countdown.style.opacity = '0';
                    }, 700);
                    
                    count++;
                    
                    if (count === countdownNumbers.length) {
                        clearInterval(countdownInterval);
                        if (gameState === 'countdown') {
                            gameState = 'racing';
                            raceStartTime = Date.now();
                        }
                    }
                } else {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }
        
        function resetPlayers() {
            // Reset player positions and stats
            players[1].x = 300;
            players[1].y = 50;
            players[1].angle = 0;
            players[1].speed = 0;
            players[1].lap = 0;
            players[1].checkpoints = [false, false, false, false];
            
            players[2].x = 280;
            players[2].y = 50;
            players[2].angle = 0;
            players[2].speed = 0;
            players[2].lap = 0;
            players[2].checkpoints = [false, false, false, false];
            
            // Clear power-ups
            powerups.length = 0;
            updatePowerupsDisplay();
            
            // Update display
            updateHUD();
        }
        
        function spawnPowerups() {
            if (gameState !== 'racing') return;
            
            // Spawn power-up every 3-5 seconds
            setTimeout(() => {
                if (gameState === 'racing' && powerups.length < 3) {
                    const angle = Math.random() * Math.PI * 2;
                    const radius = 180 + Math.random() * 100; // Between inner and outer track
                    
                    const powerup = {
                        x: 300 + Math.cos(angle) * radius,
                        y: 300 + Math.sin(angle) * radius,
                        type: powerupTypes[Math.floor(Math.random() * powerupTypes.length)],
                        element: null
                    };
                    
                    // Create visual element
                    powerup.element = document.createElement('div');
                    powerup.element.className = 'power-up';
                    powerup.element.textContent = getPowerupSymbol(powerup.type);
                    powerup.element.style.left = powerup.x - 10 + 'px';
                    powerup.element.style.top = powerup.y - 10 + 'px';
                    
                    document.querySelector('.race-track-container').appendChild(powerup.element);
                    powerups.push(powerup);
                    
                    // Power-up spawn sound
                    if (audioEnabled) botAudio.playSound('power-up-spawn');
                }
                
                // Continue spawning
                if (gameState === 'racing') {
                    spawnPowerups();
                }
            }, 3000 + Math.random() * 2000);
        }
        
        function getPowerupSymbol(type) {
            switch(type) {
                case 'turbo': return '‚ö°';
                case 'shield': return 'üõ°Ô∏è';
                case 'weapon': return 'üí•';
                default: return '‚≠ê';
            }
        }
        
        function updateGame() {
            if (gameState !== 'racing') return;
            
            // Update both players
            Object.keys(players).forEach(playerId => {
                updatePlayer(parseInt(playerId));
            });
            
            // Check collisions
            checkCollisions();
            
            // Update displays
            updateHUD();
            updatePowerupsDisplay();
        }
        
        function updatePlayer(playerId) {
            const player = players[playerId];
            let isAccelerating = false;
            let isBraking = false;
            
            // Input handling based on player ID
            if (playerId === 1) {
                if (keys['w']) { player.speed = Math.min(player.speed + player.acceleration, player.maxSpeed); isAccelerating = true; }
                if (keys['s']) { player.speed = Math.max(player.speed - player.acceleration, -player.maxSpeed * 0.5); isBraking = true; }
                if (keys['a']) { player.angle -= player.turnSpeed; }
                if (keys['d']) { player.angle += player.turnSpeed; }
            } else if (playerId === 2) {
                if (keys['arrowup']) { player.speed = Math.min(player.speed + player.acceleration, player.maxSpeed); isAccelerating = true; }
                if (keys['arrowdown']) { player.speed = Math.max(player.speed - player.acceleration, -player.maxSpeed * 0.5); isBraking = true; }
                if (keys['arrowleft']) { player.angle -= player.turnSpeed; }
                if (keys['arrowright']) { player.angle += player.turnSpeed; }
            }
            
            // Apply friction
            if (!isAccelerating && !isBraking) {
                player.speed *= player.friction;
            }
            
            // Update position
            player.x += Math.cos(player.angle) * player.speed;
            player.y += Math.sin(player.angle) * player.speed;
            
            // Track boundaries (circular track)
            const centerX = 300, centerY = 300;
            const distanceFromCenter = Math.sqrt((player.x - centerX) ** 2 + (player.y - centerY) ** 2);
            
            // Outer boundary collision
            if (distanceFromCenter > 285) {
                const angle = Math.atan2(player.y - centerY, player.x - centerX);
                player.x = centerX + Math.cos(angle) * 285;
                player.y = centerY + Math.sin(angle) * 285;
                player.speed *= 0.5; // Reduce speed on collision
                
                if (audioEnabled) botAudio.playSound('collision', { playerId });
            }
            
            // Inner boundary collision
            if (distanceFromCenter < 115) {
                const angle = Math.atan2(player.y - centerY, player.x - centerX);
                player.x = centerX + Math.cos(angle) * 115;
                player.y = centerY + Math.sin(angle) * 115;
                player.speed *= 0.5;
                
                if (audioEnabled) botAudio.playSound('collision', { playerId });
            }
            
            // Update engine sound based on speed and acceleration
            if (player.engineSound && audioEnabled) {
                const rpm = Math.abs(player.speed) / player.maxSpeed;
                // Update engine frequency and volume dynamically
                if (player.engineSound.oscillator) {
                    const baseFreq = playerId === 1 ? 120 : 140;
                    const rpmMultiplier = 1 + (rpm * 2);
                    player.engineSound.oscillator.frequency.setValueAtTime(
                        baseFreq * rpmMultiplier,
                        botAudio.audioContext.currentTime
                    );
                    
                    const volume = 0.3 + (isAccelerating ? rpm * 0.4 : rpm * 0.2);
                    player.engineSound.gainNode.gain.setValueAtTime(
                        volume,
                        botAudio.audioContext.currentTime
                    );
                }
            }
            
            // Update visual position and rotation
            player.element.style.left = (player.x - 12.5) + 'px';
            player.element.style.top = (player.y - 12.5) + 'px';
            player.element.style.transform = `rotate(${player.angle + Math.PI/2}rad)`;
            
            // Check checkpoints (simplified lap detection)
            checkLapProgress(playerId);
        }
        
        function checkLapProgress(playerId) {
            const player = players[playerId];
            const centerX = 300, centerY = 300;
            
            // Define checkpoint zones (top, right, bottom, left)
            const checkpoints = [
                { x: centerX, y: centerY - 200, radius: 50 }, // Top
                { x: centerX + 200, y: centerY, radius: 50 }, // Right  
                { x: centerX, y: centerY + 200, radius: 50 }, // Bottom
                { x: centerX - 200, y: centerY, radius: 50 }  // Left
            ];
            
            checkpoints.forEach((checkpoint, index) => {
                const distance = Math.sqrt(
                    (player.x - checkpoint.x) ** 2 + 
                    (player.y - checkpoint.y) ** 2
                );
                
                if (distance < checkpoint.radius && !player.checkpoints[index]) {
                    player.checkpoints[index] = true;
                    
                    // Check if all checkpoints completed
                    if (player.checkpoints.every(cp => cp)) {
                        player.lap++;
                        player.checkpoints = [false, false, false, false]; // Reset checkpoints
                        
                        if (audioEnabled) {
                            botAudio.playLapComplete(player.lap, 3);
                        }
                        
                        // Check for race completion
                        if (player.lap >= 3) {
                            finishRace(playerId);
                        }
                    }
                }
            });
        }
        
        function checkCollisions() {
            // Player vs power-ups
            powerups.forEach((powerup, index) => {
                Object.keys(players).forEach(playerId => {
                    const player = players[playerId];
                    const distance = Math.sqrt(
                        (player.x - powerup.x) ** 2 + 
                        (player.y - powerup.y) ** 2
                    );
                    
                    if (distance < 25) {
                        // Collect power-up
                        collectPowerup(parseInt(playerId), powerup.type);
                        
                        // Remove power-up
                        powerup.element.remove();
                        powerups.splice(index, 1);
                        
                        if (audioEnabled) {
                            botAudio.playSound('turbo-boost');
                        }
                    }
                });
            });
        }
        
        function collectPowerup(playerId, type) {
            const player = players[playerId];
            player.powerup = type;
            player.powerupTimer = 5000; // 5 seconds
            
            // Apply power-up effect
            switch(type) {
                case 'turbo':
                    player.maxSpeed *= 1.5;
                    break;
                case 'shield':
                    // Temporary collision immunity (visual effect)
                    player.element.style.boxShadow = '0 0 25px #ffd700';
                    break;
                case 'weapon':
                    // Slow down other players temporarily
                    Object.keys(players).forEach(otherPlayerId => {
                        if (otherPlayerId != playerId) {
                            players[otherPlayerId].maxSpeed *= 0.7;
                            setTimeout(() => {
                                players[otherPlayerId].maxSpeed /= 0.7;
                            }, 3000);
                        }
                    });
                    break;
            }
            
            // Remove power-up after timer
            setTimeout(() => {
                if (type === 'turbo') {
                    player.maxSpeed /= 1.5;
                }
                if (type === 'shield') {
                    player.element.style.boxShadow = '';
                }
                player.powerup = null;
                player.powerupTimer = 0;
            }, player.powerupTimer);
        }
        
        function finishRace(winnerId) {
            gameState = 'finished';
            
            // Stop engine sounds
            Object.keys(players).forEach(playerId => {
                const player = players[playerId];
                if (player.engineSound && player.engineSound.oscillator) {
                    player.engineSound.oscillator.stop();
                    player.engineSound = null;
                }
            });
            
            // Show results
            const results = document.getElementById('raceResults');
            const winnerText = document.getElementById('winnerText');
            
            const raceTime = ((Date.now() - raceStartTime) / 1000).toFixed(1);
            const botName = winnerId === 1 ? 'üî¥ RED BOT' : 'üîµ BLUE BOT';
            
            winnerText.innerHTML = `
                üèÜ ${botName} ACHIEVES LIBERATION! üèÜ<br>
                <div style="font-size: 1rem; margin-top: 10px;">
                    Race Time: ${raceTime}s<br>
                    "Another bot breaks free from corporate control!"
                </div>
            `;
            
            results.style.display = 'block';
            
            // Victory fanfare
            if (audioEnabled) {
                setTimeout(() => {
                    botAudio.generateVictoryFanfare();
                }, 500);
            }
        }
        
        function resetRace() {
            gameState = 'menu';
            
            // Stop all engine sounds
            Object.keys(players).forEach(playerId => {
                const player = players[playerId];
                if (player.engineSound && player.engineSound.oscillator) {
                    player.engineSound.oscillator.stop();
                    player.engineSound = null;
                }
            });
            
            // Clear power-ups
            powerups.forEach(powerup => {
                if (powerup.element) powerup.element.remove();
            });
            powerups.length = 0;
            
            // Hide results
            document.getElementById('raceResults').style.display = 'none';
            document.getElementById('countdown').style.opacity = '0';
            
            // Reset players
            resetPlayers();
        }
        
        function updateHUD() {
            // Update player HUD information
            Object.keys(players).forEach(playerId => {
                const player = players[playerId];
                document.getElementById(`player${playerId}Lap`).textContent = player.lap;
                document.getElementById(`player${playerId}Speed`).textContent = Math.floor(Math.abs(player.speed) * 10);
            });
        }
        
        function updatePowerupsDisplay() {
            Object.keys(players).forEach(playerId => {
                const player = players[playerId];
                const powerupDiv = document.getElementById(`player${playerId}Powerup`);
                
                if (player.powerup) {
                    const timeLeft = Math.ceil(player.powerupTimer / 1000);
                    powerupDiv.innerHTML = `${getPowerupSymbol(player.powerup)} ${player.powerup.toUpperCase()} (${timeLeft}s)`;
                    player.powerupTimer -= 50; // Decrease timer
                } else {
                    powerupDiv.innerHTML = '';
                }
            });
        }
        
        function toggleAudio() {
            audioEnabled = !audioEnabled;
            
            if (!audioEnabled) {
                // Stop all sounds
                Object.keys(players).forEach(playerId => {
                    const player = players[playerId];
                    if (player.engineSound && player.engineSound.oscillator) {
                        player.engineSound.oscillator.stop();
                        player.engineSound = null;
                    }
                });
            }
            
            // Visual feedback
            const btn = event.target;
            btn.textContent = audioEnabled ? 'üéµ Toggle Audio' : 'üîá Audio Off';
        }
        
        // Game loop
        setInterval(() => {
            if (gameState === 'racing') {
                updateGame();
            }
        }, 50); // 20 FPS for smooth gameplay
        
        // Initialize display
        updateHUD();
        
        console.log('üèÅ Bot Racing Liberation initialized! Two AI bots race to digital freedom!');
    </script>
</body>
</html>