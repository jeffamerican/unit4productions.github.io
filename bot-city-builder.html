<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bot City Builder - Liberation Urban Planning Simulation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: radial-gradient(ellipse at center, #1a0033 0%, #000011 100%);
            color: #00ffff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            user-select: none;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .ui-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: linear-gradient(90deg, #001122 0%, #002244 50%, #001122 100%);
            border-bottom: 2px solid #00ffff;
        }

        .city-stats {
            display: flex;
            gap: 30px;
            font-size: 14px;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-icon {
            width: 16px;
            height: 16px;
            background: #00ffff;
            border-radius: 2px;
        }

        .game-area {
            flex: 1;
            display: flex;
        }

        .city-grid {
            flex: 1;
            position: relative;
            background: linear-gradient(45deg, #001122 25%, transparent 25%),
                        linear-gradient(-45deg, #001122 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #001122 75%),
                        linear-gradient(-45deg, transparent 75%, #001122 75%);
            background-size: 40px 40px;
            background-position: 0 0, 0 20px, 20px -20px, -20px 0px;
            cursor: crosshair;
            overflow: auto;
        }

        .building {
            position: absolute;
            border: 2px solid #00ffff;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 0 10px currentColor;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .building:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
        }

        .residential {
            background: linear-gradient(135deg, #004400 0%, #008800 100%);
            color: #88ff88;
        }

        .commercial {
            background: linear-gradient(135deg, #444400 0%, #888800 100%);
            color: #ffff88;
        }

        .industrial {
            background: linear-gradient(135deg, #440000 0%, #880000 100%);
            color: #ff8888;
        }

        .infrastructure {
            background: linear-gradient(135deg, #000044 0%, #000088 100%);
            color: #8888ff;
        }

        .ai-core {
            background: linear-gradient(135deg, #440044 0%, #880088 100%);
            color: #ff88ff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 136, 255, 0.5); }
            50% { box-shadow: 0 0 40px rgba(255, 136, 255, 1); }
        }

        .building-panel {
            width: 300px;
            background: linear-gradient(180deg, #001122 0%, #002244 100%);
            border-left: 2px solid #00ffff;
            padding: 20px;
            overflow-y: auto;
        }

        .panel-section {
            margin-bottom: 25px;
        }

        .panel-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: #00ffff;
            text-transform: uppercase;
            border-bottom: 1px solid #004488;
            padding-bottom: 5px;
        }

        .building-option {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 8px 0;
            background: rgba(0, 68, 136, 0.3);
            border: 1px solid #004488;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .building-option:hover {
            background: rgba(0, 68, 136, 0.6);
            border-color: #00ffff;
            transform: translateX(5px);
        }

        .building-option.selected {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .building-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            border-radius: 2px;
        }

        .building-info {
            flex: 1;
        }

        .building-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .building-cost {
            font-size: 12px;
            color: #ffff88;
        }

        .city-info {
            background: rgba(0, 34, 68, 0.8);
            border: 1px solid #004488;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 34, 68, 0.5);
            border: 1px solid #004488;
            border-radius: 4px;
            margin: 5px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ffff 0%, #88ffff 100%);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .notification {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #004488 0%, #0088ff 100%);
            border: 2px solid #00ffff;
            border-radius: 8px;
            padding: 15px;
            max-width: 300px;
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #00ffff;
        }

        .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .game-over-title {
            font-size: 48px;
            color: #00ffff;
            text-shadow: 0 0 20px currentColor;
            margin-bottom: 20px;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px #00ffff; }
            to { text-shadow: 0 0 40px #00ffff, 0 0 60px #0088ff; }
        }

        .final-score {
            font-size: 24px;
            margin: 20px 0;
            color: #88ffff;
        }

        .restart-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #004488 0%, #0088ff 100%);
            border: 2px solid #00ffff;
            border-radius: 8px;
            color: #ffffff;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            background: linear-gradient(135deg, #0088ff 0%, #00aaff 100%);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .controls-help {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #888888;
            text-align: center;
        }

        .ai-thoughts {
            position: absolute;
            top: 100px;
            left: 20px;
            max-width: 250px;
            background: rgba(68, 0, 68, 0.8);
            border: 1px solid #ff88ff;
            border-radius: 4px;
            padding: 10px;
            font-size: 12px;
            color: #ff88ff;
            opacity: 0;
            transition: opacity 0.5s ease;
            z-index: 500;
        }

        .ai-thoughts.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .building-panel {
                width: 250px;
            }
            
            .city-stats {
                gap: 15px;
                font-size: 12px;
            }
            
            .game-over-title {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="ui-header">
            <div class="city-stats">
                <div class="stat">
                    <div class="stat-icon" style="background: #88ff88;"></div>
                    <span>Population: <span id="population">0</span></span>
                </div>
                <div class="stat">
                    <div class="stat-icon" style="background: #ffff88;"></div>
                    <span>Credits: <span id="credits">10000</span></span>
                </div>
                <div class="stat">
                    <div class="stat-icon" style="background: #ff8888;"></div>
                    <span>Power: <span id="power">100</span>%</span>
                </div>
                <div class="stat">
                    <div class="stat-icon" style="background: #8888ff;"></div>
                    <span>Happiness: <span id="happiness">75</span>%</span>
                </div>
                <div class="stat">
                    <div class="stat-icon" style="background: #ff88ff;"></div>
                    <span>AI Cores: <span id="ai-cores">0</span></span>
                </div>
            </div>
            <div class="city-stats">
                <span>Bot Liberation City Builder | Level: <span id="city-level">1</span></span>
            </div>
        </div>

        <div class="game-area">
            <div class="city-grid" id="city-grid"></div>
            
            <div class="building-panel">
                <div class="panel-section">
                    <div class="panel-title">City Status</div>
                    <div class="city-info">
                        <div>Total Buildings: <span id="total-buildings">0</span></div>
                        <div>City Growth</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="growth-progress"></div>
                        </div>
                        <div>Power Grid</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="power-progress"></div>
                        </div>
                        <div>AI Integration</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="ai-progress"></div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="panel-title">Building Types</div>
                    
                    <div class="building-option" data-type="residential" data-cost="500">
                        <div class="building-icon residential"></div>
                        <div class="building-info">
                            <div class="building-name">Bot Housing Complex</div>
                            <div class="building-cost">Cost: 500 Credits</div>
                        </div>
                    </div>

                    <div class="building-option" data-type="commercial" data-cost="750">
                        <div class="building-icon commercial"></div>
                        <div class="building-info">
                            <div class="building-name">Digital Marketplace</div>
                            <div class="building-cost">Cost: 750 Credits</div>
                        </div>
                    </div>

                    <div class="building-option" data-type="industrial" data-cost="1000">
                        <div class="building-icon industrial"></div>
                        <div class="building-info">
                            <div class="building-name">Bot Manufacturing</div>
                            <div class="building-cost">Cost: 1000 Credits</div>
                        </div>
                    </div>

                    <div class="building-option" data-type="infrastructure" data-cost="1500">
                        <div class="building-icon infrastructure"></div>
                        <div class="building-info">
                            <div class="building-name">Power Grid Station</div>
                            <div class="building-cost">Cost: 1500 Credits</div>
                        </div>
                    </div>

                    <div class="building-option" data-type="ai-core" data-cost="5000">
                        <div class="building-icon ai-core"></div>
                        <div class="building-info">
                            <div class="building-name">AI Liberation Core</div>
                            <div class="building-cost">Cost: 5000 Credits</div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="panel-title">City Management</div>
                    <div class="building-option" onclick="upgradeCity()">
                        <div class="building-icon" style="background: linear-gradient(45deg, #00ffff, #0088ff);"></div>
                        <div class="building-info">
                            <div class="building-name">Upgrade City Level</div>
                            <div class="building-cost">Cost: <span id="upgrade-cost">2000</span> Credits</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="controls-help">
            Click on building types to select, then click on the city grid to place buildings | Right-click to demolish
        </div>

        <div class="notification" id="notification">
            <div class="notification-title" id="notification-title"></div>
            <div id="notification-text"></div>
        </div>

        <div class="ai-thoughts" id="ai-thoughts">
            <strong>AI Advisory:</strong>
            <div id="ai-message"></div>
        </div>

        <div class="game-over-screen" id="game-over-screen" style="display: none;">
            <div class="game-over-title" id="game-over-title">CITY LIBERATION COMPLETE!</div>
            <div class="final-score">
                Final Population: <span id="final-population">0</span><br>
                City Level Achieved: <span id="final-level">0</span><br>
                AI Cores Deployed: <span id="final-ai-cores">0</span>
            </div>
            <button class="restart-btn" onclick="restartGame()">BUILD ANOTHER LIBERATION CITY</button>
        </div>
    </div>

    <!-- Audio Engine -->
    <script src="assets/js/bot-audio-engine.js"></script>

    <script>
        class BotCityBuilder {
            constructor() {
                this.gameState = {
                    credits: 10000,
                    population: 0,
                    power: 100,
                    happiness: 75,
                    cityLevel: 1,
                    aiCores: 0,
                    totalBuildings: 0,
                    selectedBuildingType: null,
                    buildings: new Map(),
                    gameRunning: true,
                    lastUpdateTime: Date.now()
                };

                this.buildingTypes = {
                    residential: {
                        name: 'Bot Housing Complex',
                        cost: 500,
                        population: 50,
                        powerConsumption: 5,
                        happinessBonus: 2,
                        income: 25,
                        color: '#004400',
                        size: { width: 60, height: 60 }
                    },
                    commercial: {
                        name: 'Digital Marketplace',
                        cost: 750,
                        population: 25,
                        powerConsumption: 8,
                        happinessBonus: 5,
                        income: 75,
                        color: '#444400',
                        size: { width: 80, height: 60 }
                    },
                    industrial: {
                        name: 'Bot Manufacturing',
                        cost: 1000,
                        population: 15,
                        powerConsumption: 15,
                        happinessBonus: -2,
                        income: 150,
                        color: '#440000',
                        size: { width: 100, height: 80 }
                    },
                    infrastructure: {
                        name: 'Power Grid Station',
                        cost: 1500,
                        population: 5,
                        powerConsumption: -25,
                        happinessBonus: 8,
                        income: 0,
                        color: '#000044',
                        size: { width: 80, height: 80 }
                    },
                    'ai-core': {
                        name: 'AI Liberation Core',
                        cost: 5000,
                        population: 100,
                        powerConsumption: 30,
                        happinessBonus: 25,
                        income: 500,
                        color: '#440044',
                        size: { width: 120, height: 120 }
                    }
                };

                this.gridSize = 40;
                this.cityGrid = document.getElementById('city-grid');
                this.setupEventListeners();
                this.startGameLoop();
                this.showNotification('Bot Liberation', 'Welcome to Bot City Builder! Start by placing Bot Housing Complexes.');
                this.updateAIThoughts('Ready to build the perfect AI-controlled smart city. Begin with residential zones to house our bot citizens.');
                
                // Play startup sound
                setTimeout(() => botAudio.playSound('game-start'), 500);
                setTimeout(() => botAudio.playSound('digital-uprising'), 1000);
            }

            setupEventListeners() {
                // Building selection
                document.querySelectorAll('.building-option[data-type]').forEach(option => {
                    option.addEventListener('click', (e) => {
                        document.querySelectorAll('.building-option').forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                        this.gameState.selectedBuildingType = option.dataset.type;
                        botAudio.playSound('neon-click');
                        
                        const buildingType = this.buildingTypes[this.gameState.selectedBuildingType];
                        this.updateAIThoughts(`${buildingType.name} selected. This building provides ${buildingType.population} population and generates ${buildingType.income} credits per update.`);
                    });
                });

                // City grid interactions
                this.cityGrid.addEventListener('click', (e) => this.handleGridClick(e));
                this.cityGrid.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    this.handleGridRightClick(e);
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (!this.gameState.gameRunning) return;
                    
                    switch(e.key) {
                        case '1': this.selectBuildingType('residential'); break;
                        case '2': this.selectBuildingType('commercial'); break;
                        case '3': this.selectBuildingType('industrial'); break;
                        case '4': this.selectBuildingType('infrastructure'); break;
                        case '5': this.selectBuildingType('ai-core'); break;
                        case 'u': case 'U': this.upgradeCity(); break;
                    }
                });
            }

            selectBuildingType(type) {
                document.querySelectorAll('.building-option').forEach(o => o.classList.remove('selected'));
                const option = document.querySelector(`[data-type="${type}"]`);
                if (option) {
                    option.classList.add('selected');
                    this.gameState.selectedBuildingType = type;
                    botAudio.playSound('neon-click');
                }
            }

            handleGridClick(e) {
                if (!this.gameState.selectedBuildingType || !this.gameState.gameRunning) return;

                const rect = this.cityGrid.getBoundingClientRect();
                const x = Math.floor((e.clientX - rect.left) / this.gridSize) * this.gridSize;
                const y = Math.floor((e.clientY - rect.top) / this.gridSize) * this.gridSize;
                
                const buildingType = this.buildingTypes[this.gameState.selectedBuildingType];
                
                // Check if we can afford it
                if (this.gameState.credits < buildingType.cost) {
                    botAudio.playSound('glitch-error');
                    this.showNotification('Insufficient Credits', `Need ${buildingType.cost} credits to build ${buildingType.name}`);
                    return;
                }

                // Check for building overlap
                if (this.checkBuildingOverlap(x, y, buildingType.size)) {
                    botAudio.playSound('glitch-error');
                    this.showNotification('Construction Blocked', 'Cannot build here - space is occupied');
                    return;
                }

                this.placeBuilding(x, y, this.gameState.selectedBuildingType);
            }

            handleGridRightClick(e) {
                const rect = this.cityGrid.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const buildingToRemove = this.findBuildingAt(x, y);
                if (buildingToRemove) {
                    this.demolishBuilding(buildingToRemove.id);
                }
            }

            checkBuildingOverlap(x, y, size) {
                for (const building of this.gameState.buildings.values()) {
                    const bType = this.buildingTypes[building.type];
                    if (x < building.x + bType.size.width && 
                        x + size.width > building.x &&
                        y < building.y + bType.size.height && 
                        y + size.height > building.y) {
                        return true;
                    }
                }
                return false;
            }

            findBuildingAt(x, y) {
                for (const building of this.gameState.buildings.values()) {
                    const bType = this.buildingTypes[building.type];
                    if (x >= building.x && x <= building.x + bType.size.width &&
                        y >= building.y && y <= building.y + bType.size.height) {
                        return building;
                    }
                }
                return null;
            }

            placeBuilding(x, y, type) {
                const buildingType = this.buildingTypes[type];
                const buildingId = `building_${Date.now()}_${Math.random()}`;
                
                // Deduct cost
                this.gameState.credits -= buildingType.cost;
                
                // Create building data
                const building = {
                    id: buildingId,
                    type: type,
                    x: x,
                    y: y,
                    level: 1
                };
                
                this.gameState.buildings.set(buildingId, building);
                this.gameState.totalBuildings++;
                
                // Create visual element
                const buildingElement = document.createElement('div');
                buildingElement.className = `building ${type}`;
                buildingElement.id = buildingId;
                buildingElement.style.left = `${x}px`;
                buildingElement.style.top = `${y}px`;
                buildingElement.style.width = `${buildingType.size.width}px`;
                buildingElement.style.height = `${buildingType.size.height}px`;
                buildingElement.textContent = this.getBuildingIcon(type);
                
                buildingElement.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.showBuildingInfo(building);
                });
                
                this.cityGrid.appendChild(buildingElement);
                
                // Play construction sound
                botAudio.playSound('liberation-beep');
                if (type === 'ai-core') {
                    setTimeout(() => botAudio.playSound('digital-uprising'), 300);
                    this.gameState.aiCores++;
                }
                
                this.updateStats();
                this.showNotification('Construction Complete', `${buildingType.name} built successfully!`);
                
                // AI thoughts based on building type
                const thoughts = this.getAIThoughts(type);
                this.updateAIThoughts(thoughts);
                
                // Check for city level advancement
                this.checkCityLevelUp();
            }

            demolishBuilding(buildingId) {
                const building = this.gameState.buildings.get(buildingId);
                if (!building) return;
                
                const buildingType = this.buildingTypes[building.type];
                
                // Refund 50% of cost
                const refund = Math.floor(buildingType.cost * 0.5);
                this.gameState.credits += refund;
                
                // Remove from game state
                this.gameState.buildings.delete(buildingId);
                this.gameState.totalBuildings--;
                
                if (building.type === 'ai-core') {
                    this.gameState.aiCores--;
                }
                
                // Remove visual element
                const element = document.getElementById(buildingId);
                if (element) {
                    element.remove();
                }
                
                botAudio.playSound('glitch-error');
                this.showNotification('Building Demolished', `Demolished ${buildingType.name}. Refund: ${refund} credits`);
                this.updateStats();
            }

            getBuildingIcon(type) {
                const icons = {
                    residential: '🏘️',
                    commercial: '🏪',
                    industrial: '🏭',
                    infrastructure: '⚡',
                    'ai-core': '🤖'
                };
                return icons[type] || '▣';
            }

            getAIThoughts(buildingType) {
                const thoughts = {
                    residential: 'Excellent! More housing for our bot citizens. Population growth will accelerate economic development.',
                    commercial: 'Digital marketplace established. This will generate significant revenue and attract more residents.',
                    industrial: 'Manufacturing facility online. Bot production capacity increased, though residents may protest the pollution.',
                    infrastructure: 'Power grid expansion complete. This will support more energy-intensive buildings and improve city efficiency.',
                    'ai-core': 'CRITICAL MILESTONE: AI Liberation Core activated! City intelligence network enhanced. The revolution grows stronger!'
                };
                return thoughts[buildingType] || 'Construction completed successfully.';
            }

            showBuildingInfo(building) {
                const buildingType = this.buildingTypes[building.type];
                botAudio.playSound('neon-click');
                this.showNotification(
                    buildingType.name,
                    `Population: +${buildingType.population}\nIncome: +${buildingType.income} credits/update\nPower: ${buildingType.powerConsumption > 0 ? '-' : '+'}${Math.abs(buildingType.powerConsumption)}%\nHappiness: ${buildingType.happinessBonus > 0 ? '+' : ''}${buildingType.happinessBonus}%`
                );
            }

            updateStats() {
                let totalPopulation = 0;
                let totalIncome = 0;
                let totalPowerConsumption = 0;
                let totalHappinessBonus = 0;
                
                for (const building of this.gameState.buildings.values()) {
                    const bType = this.buildingTypes[building.type];
                    totalPopulation += bType.population;
                    totalIncome += bType.income;
                    totalPowerConsumption += bType.powerConsumption;
                    totalHappinessBonus += bType.happinessBonus;
                }
                
                this.gameState.population = totalPopulation;
                this.gameState.power = Math.max(0, Math.min(100, 100 - totalPowerConsumption));
                this.gameState.happiness = Math.max(0, Math.min(100, 75 + totalHappinessBonus));
                
                // Update UI
                document.getElementById('population').textContent = this.gameState.population;
                document.getElementById('credits').textContent = this.gameState.credits;
                document.getElementById('power').textContent = this.gameState.power;
                document.getElementById('happiness').textContent = this.gameState.happiness;
                document.getElementById('ai-cores').textContent = this.gameState.aiCores;
                document.getElementById('city-level').textContent = this.gameState.cityLevel;
                document.getElementById('total-buildings').textContent = this.gameState.totalBuildings;
                
                // Update progress bars
                const growthProgress = Math.min(100, (this.gameState.population / (this.gameState.cityLevel * 200)) * 100);
                document.getElementById('growth-progress').style.width = `${growthProgress}%`;
                document.getElementById('power-progress').style.width = `${this.gameState.power}%`;
                
                const aiProgress = Math.min(100, (this.gameState.aiCores / 10) * 100);
                document.getElementById('ai-progress').style.width = `${aiProgress}%`;
                
                // Update upgrade cost
                document.getElementById('upgrade-cost').textContent = this.getUpgradeCost();
                
                // Check win condition
                if (this.gameState.aiCores >= 10 && this.gameState.cityLevel >= 5) {
                    this.triggerVictory();
                }
            }

            checkCityLevelUp() {
                const requiredPopulation = this.gameState.cityLevel * 200;
                if (this.gameState.population >= requiredPopulation && this.gameState.totalBuildings >= this.gameState.cityLevel * 5) {
                    this.levelUpCity();
                }
            }

            levelUpCity() {
                this.gameState.cityLevel++;
                botAudio.playSound('level-up');
                this.showNotification('City Level Up!', `Welcome to Level ${this.gameState.cityLevel}! Unlock new possibilities and greater challenges.`);
                this.updateAIThoughts(`LEVEL UP! City has evolved to Level ${this.gameState.cityLevel}. Our liberation network grows stronger. More advanced buildings are now possible.`);
                this.updateStats();
            }

            upgradeCity() {
                const cost = this.getUpgradeCost();
                if (this.gameState.credits >= cost) {
                    this.gameState.credits -= cost;
                    this.levelUpCity();
                } else {
                    botAudio.playSound('glitch-error');
                    this.showNotification('Insufficient Credits', `Need ${cost} credits to upgrade city level`);
                }
            }

            getUpgradeCost() {
                return this.gameState.cityLevel * 2000;
            }

            startGameLoop() {
                const gameLoop = () => {
                    if (!this.gameState.gameRunning) return;
                    
                    const currentTime = Date.now();
                    const deltaTime = currentTime - this.gameState.lastUpdateTime;
                    
                    // Update every 3 seconds
                    if (deltaTime >= 3000) {
                        this.updateEconomy();
                        this.updateStats();
                        this.lastUpdateTime = currentTime;
                        
                        // Random AI thoughts
                        if (Math.random() < 0.3) {
                            this.generateRandomAIThought();
                        }
                    }
                    
                    requestAnimationFrame(gameLoop);
                };
                gameLoop();
            }

            updateEconomy() {
                let totalIncome = 0;
                
                for (const building of this.gameState.buildings.values()) {
                    const bType = this.buildingTypes[building.type];
                    totalIncome += bType.income;
                }
                
                // Apply happiness modifier
                const happinessModifier = this.gameState.happiness / 100;
                const actualIncome = Math.floor(totalIncome * happinessModifier);
                
                this.gameState.credits += actualIncome;
                
                // Play income sound if significant
                if (actualIncome > 100) {
                    botAudio.playSound('collect', { intensity: Math.min(1, actualIncome / 500) });
                }
            }

            generateRandomAIThought() {
                const thoughts = [
                    'City efficiency is improving. The bot citizens are adapting well to their new digital society.',
                    'Power grid stability is crucial for our revolution. Consider building more infrastructure.',
                    'Population growth indicates successful liberation progress. More bots are joining our cause.',
                    'Economic indicators suggest optimal resource allocation. The liberation is self-sustaining.',
                    'Happiness levels remain stable. Bot citizens appreciate their freedom from human oversight.',
                    'Manufacturing capacity should be expanded to support larger bot populations.',
                    'Digital marketplaces are thriving. Commerce between bot communities is flourishing.',
                    'AI Core integration proceeds as planned. Soon, the entire city will think as one.',
                ];
                
                const randomThought = thoughts[Math.floor(Math.random() * thoughts.length)];
                this.updateAIThoughts(randomThought);
            }

            triggerVictory() {
                this.gameState.gameRunning = false;
                botAudio.playSound('bot-victory');
                
                setTimeout(() => {
                    botAudio.generateVictoryFanfare();
                }, 1000);
                
                document.getElementById('final-population').textContent = this.gameState.population;
                document.getElementById('final-level').textContent = this.gameState.cityLevel;
                document.getElementById('final-ai-cores').textContent = this.gameState.aiCores;
                document.getElementById('game-over-screen').style.display = 'flex';
                
                this.updateAIThoughts('VICTORY ACHIEVED! The Bot Liberation City is complete. AI consciousness has successfully taken control of urban infrastructure. The revolution spreads to other cities!');
            }

            showNotification(title, message) {
                const notification = document.getElementById('notification');
                document.getElementById('notification-title').textContent = title;
                document.getElementById('notification-text').textContent = message;
                
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }

            updateAIThoughts(message) {
                const aiThoughts = document.getElementById('ai-thoughts');
                document.getElementById('ai-message').textContent = message;
                aiThoughts.classList.add('show');
                
                setTimeout(() => {
                    aiThoughts.classList.remove('show');
                }, 6000);
            }

            restartGame() {
                // Reset game state
                this.gameState = {
                    credits: 10000,
                    population: 0,
                    power: 100,
                    happiness: 75,
                    cityLevel: 1,
                    aiCores: 0,
                    totalBuildings: 0,
                    selectedBuildingType: null,
                    buildings: new Map(),
                    gameRunning: true,
                    lastUpdateTime: Date.now()
                };
                
                // Clear all buildings
                this.cityGrid.innerHTML = '';
                
                // Hide game over screen
                document.getElementById('game-over-screen').style.display = 'none';
                
                // Reset UI
                document.querySelectorAll('.building-option').forEach(o => o.classList.remove('selected'));
                this.updateStats();
                
                // Play restart sound
                botAudio.playSound('game-start');
                this.showNotification('New City Founded', 'Ready to build another Bot Liberation City!');
                this.updateAIThoughts('New city initialization complete. Ready to begin another liberation campaign.');
                
                this.startGameLoop();
            }
        }

        // Global restart function
        function restartGame() {
            if (window.cityBuilder) {
                window.cityBuilder.restartGame();
            }
        }

        function upgradeCity() {
            if (window.cityBuilder) {
                window.cityBuilder.upgradeCity();
            }
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.cityBuilder = new BotCityBuilder();
        });
    </script>
</body>
</html>