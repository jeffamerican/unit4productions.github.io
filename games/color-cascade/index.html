<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Cascade - Match-3 Physics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .game-container {
            width: 400px;
            height: 600px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
            position: relative;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .game-header {
            padding: 20px;
            text-align: center;
            color: white;
            background: rgba(0, 0, 0, 0.2);
        }

        .score {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .level {
            font-size: 16px;
            opacity: 0.8;
        }

        .game-board {
            width: 100%;
            height: 480px;
            position: relative;
            background: rgba(0, 0, 0, 0.1);
        }

        .block {
            position: absolute;
            width: 35px;
            height: 35px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .block:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.4);
        }

        .block.red { background: linear-gradient(45deg, #ff6b6b, #ee5a24); }
        .block.blue { background: linear-gradient(45deg, #74b9ff, #0984e3); }
        .block.green { background: linear-gradient(45deg, #55efc4, #00b894); }
        .block.yellow { background: linear-gradient(45deg, #fdcb6e, #f39c12); }
        .block.purple { background: linear-gradient(45deg, #a29bfe, #6c5ce7); }
        .block.orange { background: linear-gradient(45deg, #fd79a8, #e84393); }

        .block.selected {
            animation: pulse 0.5s infinite alternate;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        }

        .block.matched {
            animation: explode 0.6s ease-out forwards;
        }

        .chain-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            animation: chainPop 1s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }

        .game-over {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            z-index: 2000;
        }

        .game-over h2 {
            font-size: 32px;
            margin-bottom: 20px;
        }

        .game-over button {
            padding: 15px 30px;
            font-size: 18px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }

        .share-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.2); }
        }

        @keyframes explode {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.5) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(2) rotate(360deg); opacity: 0; }
        }

        @keyframes chainPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1) translateY(-100px); opacity: 0; }
        }

        @keyframes fall {
            to { transform: translateY(480px); }
        }

        @media (max-width: 480px) {
            .game-container {
                width: 95vw;
                height: 85vh;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button class="share-button" onclick="shareScore()">Share</button>
        <div class="game-header">
            <div class="score">Score: <span id="score">0</span></div>
            <div class="level">Level: <span id="level">1</span></div>
        </div>
        <div class="game-board" id="gameBoard"></div>
        <div class="game-over" id="gameOver">
            <h2>Game Over!</h2>
            <p>Final Score: <span id="finalScore">0</span></p>
            <p>Level Reached: <span id="finalLevel">1</span></p>
            <button onclick="restartGame()">Play Again</button>
            <button onclick="shareScore()">Share Score</button>
        </div>
    </div>

    <script>
        class ColorCascade {
            constructor() {
                this.board = document.getElementById('gameBoard');
                this.score = 0;
                this.level = 1;
                this.blocks = [];
                this.colors = ['red', 'blue', 'green', 'yellow', 'purple', 'orange'];
                this.selectedBlocks = [];
                this.gameRunning = true;
                this.dropSpeed = 2;
                this.spawnRate = 0.02;
                this.chainMultiplier = 1;
                
                this.initGame();
                this.gameLoop();
            }

            initGame() {
                this.updateDisplay();
                this.spawnInitialBlocks();
            }

            spawnInitialBlocks() {
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => this.spawnBlock(), i * 200);
                }
            }

            spawnBlock() {
                if (!this.gameRunning) return;

                const block = document.createElement('div');
                const color = this.colors[Math.floor(Math.random() * this.colors.length)];
                
                block.className = `block ${color}`;
                block.style.left = Math.random() * (this.board.clientWidth - 35) + 'px';
                block.style.top = '-35px';
                
                const blockData = {
                    element: block,
                    color: color,
                    x: parseInt(block.style.left),
                    y: -35,
                    falling: true,
                    matched: false
                };

                block.addEventListener('click', () => this.selectBlock(blockData));
                
                this.board.appendChild(block);
                this.blocks.push(blockData);
            }

            selectBlock(blockData) {
                if (!this.gameRunning || blockData.matched || blockData.falling) return;

                const block = blockData.element;
                
                if (block.classList.contains('selected')) {
                    block.classList.remove('selected');
                    this.selectedBlocks = this.selectedBlocks.filter(b => b !== blockData);
                } else {
                    if (this.selectedBlocks.length === 0 || 
                        this.selectedBlocks[0].color === blockData.color) {
                        block.classList.add('selected');
                        this.selectedBlocks.push(blockData);
                        
                        if (this.selectedBlocks.length >= 3) {
                            this.matchBlocks();
                        }
                    }
                }
            }

            matchBlocks() {
                if (this.selectedBlocks.length < 3) return;

                const matchScore = this.selectedBlocks.length * 100 * this.chainMultiplier;
                this.score += matchScore;
                this.chainMultiplier += 0.5;

                // Show chain indicator
                if (this.chainMultiplier > 1) {
                    this.showChainIndicator(`Chain x${this.chainMultiplier.toFixed(1)}!`);
                }

                this.selectedBlocks.forEach(blockData => {
                    blockData.matched = true;
                    blockData.element.classList.add('matched');
                    
                    setTimeout(() => {
                        if (blockData.element.parentNode) {
                            blockData.element.parentNode.removeChild(blockData.element);
                        }
                    }, 600);
                });

                this.blocks = this.blocks.filter(b => !this.selectedBlocks.includes(b));
                this.selectedBlocks = [];
                
                this.updateDisplay();
                this.checkLevelUp();
                
                // Reset chain multiplier after 2 seconds
                setTimeout(() => {
                    this.chainMultiplier = 1;
                }, 2000);
            }

            showChainIndicator(text) {
                const indicator = document.createElement('div');
                indicator.className = 'chain-indicator';
                indicator.textContent = text;
                indicator.style.left = Math.random() * (this.board.clientWidth - 100) + 'px';
                indicator.style.top = Math.random() * (this.board.clientHeight - 50) + 'px';
                
                this.board.appendChild(indicator);
                
                setTimeout(() => {
                    if (indicator.parentNode) {
                        indicator.parentNode.removeChild(indicator);
                    }
                }, 1000);
            }

            checkLevelUp() {
                const newLevel = Math.floor(this.score / 2000) + 1;
                if (newLevel > this.level) {
                    this.level = newLevel;
                    this.dropSpeed += 0.5;
                    this.spawnRate += 0.005;
                    this.showChainIndicator(`Level ${this.level}!`);
                }
            }

            updateDisplay() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('level').textContent = this.level;
            }

            gameLoop() {
                if (!this.gameRunning) return;

                // Spawn new blocks
                if (Math.random() < this.spawnRate) {
                    this.spawnBlock();
                }

                // Update falling blocks
                this.blocks.forEach(blockData => {
                    if (blockData.falling && !blockData.matched) {
                        blockData.y += this.dropSpeed;
                        blockData.element.style.top = blockData.y + 'px';

                        // Stop falling when reaching bottom or another block
                        if (blockData.y >= this.board.clientHeight - 35) {
                            blockData.falling = false;
                            blockData.y = this.board.clientHeight - 35;
                            blockData.element.style.top = blockData.y + 'px';
                        }

                        // Check collision with other blocks
                        this.blocks.forEach(otherBlock => {
                            if (otherBlock !== blockData && !otherBlock.falling && !otherBlock.matched) {
                                const dx = Math.abs(blockData.x - otherBlock.x);
                                const dy = Math.abs(blockData.y - otherBlock.y);
                                
                                if (dx < 35 && dy < 35 && blockData.y < otherBlock.y) {
                                    blockData.falling = false;
                                    blockData.y = otherBlock.y - 35;
                                    blockData.element.style.top = blockData.y + 'px';
                                }
                            }
                        });
                    }
                });

                // Check game over (blocks reached top)
                const topBlocks = this.blocks.filter(b => !b.falling && b.y <= 35);
                if (topBlocks.length > 8) {
                    this.gameOver();
                    return;
                }

                requestAnimationFrame(() => this.gameLoop());
            }

            gameOver() {
                this.gameRunning = false;
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('finalLevel').textContent = this.level;
                document.getElementById('gameOver').style.display = 'flex';
                
                // Store high score
                const highScore = localStorage.getItem('colorCascadeHighScore') || 0;
                if (this.score > highScore) {
                    localStorage.setItem('colorCascadeHighScore', this.score);
                }
            }
        }

        let game;

        function startGame() {
            game = new ColorCascade();
        }

        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('gameBoard').innerHTML = '';
            startGame();
        }

        function shareScore() {
            const score = game ? game.score : 0;
            const level = game ? game.level : 1;
            const text = `I just scored ${score} points and reached level ${level} in Color Cascade! Can you beat my score?`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Color Cascade High Score',
                    text: text,
                    url: window.location.href
                });
            } else {
                const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(window.location.href)}`;
                window.open(url, '_blank');
            }
        }

        // Touch controls for mobile
        let touchStartX, touchStartY;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            if (!touchStartX || !touchStartY) return;
            
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;
            
            // Reset for next touch
            touchStartX = null;
            touchStartY = null;
        });

        // Start the game
        startGame();
    </script>
</body>
</html>